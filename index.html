<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Trabajos</title>
</head>
<body>
    
    <canvas id="myCanvas" width="1000" height="500" style="border:2px solid #000000;"></canvas>
    
    <script>
        class Rectángulo {
            constructor(x, y, width, height, ctx) {
                this.x = x;
                this.y = y;
                this.width = width;
                this.height = height;
                this.ctx = ctx;
            }

            dibujar() {
                this.ctx.fillStyle = "black";
                this.ctx.fillRect(this.x, this.y, this.width, this.height);
                this.ctx.strokeRect(this.x, this.y, this.width, this.height);
            }
        }

        var canvas = document.getElementById('myCanvas'); 
        var ctx = canvas.getContext("2d");
        var x = 400;
        var y = 150;
        var x2 = 800, y2 = 200;
        var color = "red";
        var dir = 0;
        ctx.fillStyle = color;
        var pause=false;

        var muros = [];
        muros.push(new Rectángulo(100, 100, 500, 20, ctx));
        muros.push(new Rectángulo(100, 350, 500, 20, ctx));

        document.addEventListener("keydown", (e) => {
            console.log(e);

            switch (e.keyCode) {
        case 87:
            if (!pause) { 
                dir = 1;
            }
            break;
        case 83:
            if (!pause) { 
                dir = 2;
            }
            break;
        case 68:
            if (!pause) { 
                dir = 3;
            }
            break;
        case 65:
            if (!pause) { 
                dir = 4;
            }
            break;
        case 32:
            pause = !pause;
            break;
    }

            color = randomRGB();
            ctx.fillStyle = color;
        });

        ctx.fillRect(x, y, 100, 100);
        ctx.strokeRect(x, y, 100, 100);

        function repaint() {
            if(!pause){
                ctx.fillStyle = "white";
                ctx.fillRect(0, 0, 1000, 500);

                color = randomRGB();
                ctx.fillStyle = color;

                ctx.fillRect(x, y, 100, 100);
                ctx.strokeRect(x, y, 100, 100);

                randomSquare();
                muro();
            }else{
                ctx.fillStyle = "rgba(154,160,154,0.020)";
                ctx.fillRect(0, 0, 1000, 500);

                ctx.font = "40px Arial";
                ctx.fillStyle = "black"; 
                ctx.fillText("p "+"a "+"u "+"s "+"a", 1000/ 2 - 120, 500/ 2);
            }
        }

        function update() {
            if(pause==false){
                console.log("dir " + dir);

                var auxX = x;
                var auxY = y;

                switch (dir) {
                    case 1:
                        y -= 5;
                        if (colisionMuro()) {
                            y = auxY;
                        }
                        if (y < -50) { y = 550 }
                        break;
                    case 2:
                        y += 5;
                        if (colisionMuro()) {
                            y = auxY;
                        }
                        if (y > 550) { y = -50 }
                        break;
                    case 3:
                        x += 5;
                        if (colisionMuro()) {
                            x = auxX;
                        }
                        if (x > 1050) { x = -50 }
                        break;
                    case 4:
                        x -= 5;
                        if (colisionMuro()) {
                            x = auxX;
                        }
                        if (x < -50) { x = 1050 }
                        break;
                }
            }
            repaint();
            window.requestAnimationFrame(update);
        }

        window.requestAnimationFrame = (function () {
            return window.requestAnimationFrame ||
                window.webkitRequestAnimationFrame ||
                window.mozRequestAnimationFrame ||
                function (callback) {
                    window.setTimeout(callback, 17);
                };
        }());

        window.requestAnimationFrame(update);

        function randomRGB() {
            var x = Math.floor(Math.random() * 256);
            var y = Math.floor(Math.random() * 256);
            var z = Math.floor(Math.random() * 256);
            return "rgb(" + x + "," + y + "," + z + ", 0.5)";
        }

        function muro() {
            muros.forEach((muro) => {
                muro.dibujar();
            });
        }

        function randomSquare() {
            if (colision()) {
                var testX = Math.floor(Math.random() * 900);
                var testY = Math.floor(Math.random() * 400);
                x2 = testX;
                y2 = testY;
            }
            ctx.fillStyle = "black";
            ctx.fillRect(x2, y2, 100, 100);
        }

        function colision() {
            return (
                x + 100 >= x2 &&
                x2 + 100 >= x &&
                y + 100 >= y2 &&
                y2 + 100 >= y
            )
        }

        function colisionMuro() {
            for (var i = 0; i < muros.length; i++) {
                var muro = muros[i];
                if (
                    x + 100 >= muro.x &&
                    muro.x + muro.width >= x &&
                    y + 100 >= muro.y &&
                    muro.y + muro.height >= y
                ) {
                    return true;
                }
            }
            return false;
        }
        


    </script>
</body>
</html>